<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio CMS - Professional Admin Panel</title>

    <!-- React & Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Quill Editor Dark Theme */
        .ql-toolbar.ql-snow {
            background: #1e293b;
            border-color: #334155;
        }

        .ql-container.ql-snow {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        .ql-editor {
            min-height: 200px;
            font-size: 14px;
            line-height: 1.6;
        }

        .ql-snow .ql-stroke {
            stroke: #94a3b8;
        }

        .ql-snow .ql-fill {
            fill: #94a3b8;
        }

        .ql-snow .ql-picker-label {
            color: #94a3b8;
        }

        /* Image Preview Grid */
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-preview-item {
            position: relative;
            aspect-ratio: 16/9;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #1e293b;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .image-preview-item.selected {
            border-color: #10b981;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #10b981;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .remove-image-btn {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: #ef4444;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .image-preview-item:hover .remove-image-btn {
            opacity: 1;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid #334155;
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, createElement: e } = React;

        // Rich Text Editor Component
        function RichTextEditor({ value, onChange, placeholder }) {
            const editorRef = useRef(null);
            const quillRef = useRef(null);

            useEffect(() => {
                if (editorRef.current && !quillRef.current) {
                    quillRef.current = new Quill(editorRef.current, {
                        theme: 'snow',
                        placeholder: placeholder || 'Enter content...',
                        modules: {
                            toolbar: [
                                [{ 'header': [1, 2, 3, false] }],
                                ['bold', 'italic', 'underline', 'strike'],
                                ['blockquote', 'code-block'],
                                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                ['link', 'image'],
                                ['clean']
                            ]
                        }
                    });

                    quillRef.current.on('text-change', () => {
                        const html = quillRef.current.root.innerHTML;
                        onChange(html === '<p><br></p>' ? '' : html);
                    });
                }

                if (quillRef.current && value !== quillRef.current.root.innerHTML) {
                    quillRef.current.root.innerHTML = value || '';
                }
            }, []);

            return e('div', { ref: editorRef, className: 'bg-slate-900 rounded-lg' });
        }

        // Main App Component
        function AdminApp() {
            const [authenticated, setAuthenticated] = useState(false);
            const [loading, setLoading] = useState(true);
            const [currentView, setCurrentView] = useState('dashboard');
            const [projects, setProjects] = useState([]);
            const [messages, setMessages] = useState([]);
            const [technologies, setTechnologies] = useState([]);
            const [editingProject, setEditingProject] = useState(null);
            const [user, setUser] = useState(null);

            useEffect(() => {
                checkAuth();
            }, []);

            const checkAuth = async () => {
                try {
                    const res = await fetch('/api/auth/check');
                    const data = await res.json();
                    if (data.authenticated) {
                        setAuthenticated(true);
                        setUser(data.user);
                        loadData();
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadData = async () => {
                try {
                    const [projectsRes, messagesRes, techRes] = await Promise.all([
                        fetch('/api/projects'),
                        fetch('/api/messages'),
                        fetch('/api/technologies')
                    ]);

                    if (projectsRes.ok) {
                        const projectsData = await projectsRes.json();
                        setProjects(projectsData.data || []);
                    }

                    if (messagesRes.ok) {
                        const messagesData = await messagesRes.json();
                        setMessages(messagesData.data || []);
                    }

                    if (techRes.ok) {
                        const techData = await techRes.json();
                        setTechnologies(techData.data || []);
                    }
                } catch (error) {
                    console.error('Failed to load data:', error);
                }
            };

            const handleLogin = async (username, password) => {
                try {
                    const res = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });

                    const data = await res.json();
                    if (data.success) {
                        setAuthenticated(true);
                        setUser(data.user);
                        loadData();
                        return { success: true };
                    }
                    return { success: false, message: data.message };
                } catch (error) {
                    return { success: false, message: 'Login failed' };
                }
            };

            const handleLogout = async () => {
                await fetch('/api/auth/logout', { method: 'POST' });
                setAuthenticated(false);
                setUser(null);
            };

            if (loading) {
                return e('div', { className: 'loading-overlay' },
                    e('div', { className: 'spinner' })
                );
            }

            if (!authenticated) {
                return e(LoginScreen, { onLogin: handleLogin });
            }

            return e('div', { className: 'flex h-screen bg-slate-950' },
                e(Sidebar, {
                    currentView,
                    onViewChange: setCurrentView,
                    user,
                    onLogout: handleLogout
                }),
                e('div', { className: 'flex-1 overflow-auto' },
                    e('main', { className: 'p-8' },
                        currentView === 'dashboard' && e(Dashboard, { projects, messages }),
                        currentView === 'projects' && e(ProjectsManager, {
                            projects,
                            technologies,
                            onRefresh: loadData
                        }),
                        currentView === 'messages' && e(MessagesManager, {
                            messages,
                            onRefresh: loadData
                        }),
                        currentView === 'analytics' && e(Analytics, { projects, messages })
                    )
                )
            );
        }

        // Login Screen
        function LoginScreen({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                const result = await onLogin(username, password);
                if (!result.success) {
                    setError(result.message || 'Invalid credentials');
                }
                setLoading(false);
            };

            return e('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4' },
                e('div', { className: 'bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-2xl p-8 w-full max-w-md border border-slate-700' },
                    e('div', { className: 'text-center mb-8' },
                        e('h1', { className: 'text-3xl font-bold text-white mb-2' }, 'Portfolio CMS'),
                        e('p', { className: 'text-slate-400' }, 'Sign in to manage your portfolio')
                    ),
                    e('form', { onSubmit: handleSubmit },
                        error && e('div', { className: 'bg-red-500/10 border border-red-500/50 text-red-400 p-3 rounded-lg mb-4' }, error),
                        e('div', { className: 'mb-4' },
                            e('label', { className: 'block text-slate-300 mb-2' }, 'Username'),
                            e('input', {
                                type: 'text',
                                value: username,
                                onChange: (e) => setUsername(e.target.value),
                                className: 'w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white focus:border-emerald-500 focus:outline-none',
                                required: true
                            })
                        ),
                        e('div', { className: 'mb-6' },
                            e('label', { className: 'block text-slate-300 mb-2' }, 'Password'),
                            e('input', {
                                type: 'password',
                                value: password,
                                onChange: (e) => setPassword(e.target.value),
                                className: 'w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white focus:border-emerald-500 focus:outline-none',
                                required: true
                            })
                        ),
                        e('button', {
                            type: 'submit',
                            disabled: loading,
                            className: 'w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50'
                        }, loading ? 'Signing in...' : 'Sign In')
                    )
                )
            );
        }

        // Sidebar Component
        function Sidebar({ currentView, onViewChange, user, onLogout }) {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: '📊' },
                { id: 'projects', label: 'Projects', icon: '📁' },
                { id: 'messages', label: 'Messages', icon: '💬' },
                { id: 'analytics', label: 'Analytics', icon: '📈' },
            ];

            return e('div', { className: 'w-64 bg-slate-900 border-r border-slate-800' },
                e('div', { className: 'p-6' },
                    e('h1', { className: 'text-2xl font-bold text-emerald-400' }, 'Portfolio CMS')
                ),
                e('nav', { className: 'flex-1 px-4' },
                    menuItems.map(item =>
                        e('button', {
                            key: item.id,
                            onClick: () => onViewChange(item.id),
                            className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg mb-2 transition-colors ${
                                currentView === item.id
                                    ? 'bg-emerald-500/20 text-emerald-400'
                                    : 'text-slate-400 hover:bg-slate-800 hover:text-white'
                            }`
                        },
                            e('span', null, item.icon),
                            e('span', null, item.label)
                        )
                    )
                ),
                e('div', { className: 'p-4 border-t border-slate-800' },
                    e('div', { className: 'flex items-center justify-between' },
                        e('div', null,
                            e('div', { className: 'text-sm font-medium' }, user?.username),
                            e('div', { className: 'text-xs text-slate-500' }, user?.role)
                        ),
                        e('button', {
                            onClick: onLogout,
                            className: 'text-slate-400 hover:text-white'
                        }, '🚪')
                    )
                )
            );
        }

        // Dashboard Component
        function Dashboard({ projects, messages }) {
            const stats = {
                totalProjects: projects.length,
                featuredProjects: projects.filter(p => p.featured).length,
                unreadMessages: messages.filter(m => !m.is_read).length,
                totalMessages: messages.length
            };

            return e('div', null,
                e('h2', { className: 'text-3xl font-bold mb-8' }, 'Dashboard'),

                e('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8' },
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-emerald-400 mb-2' }, stats.totalProjects),
                        e('div', { className: 'text-slate-400' }, 'Total Projects')
                    ),
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-blue-400 mb-2' }, stats.featuredProjects),
                        e('div', { className: 'text-slate-400' }, 'Featured')
                    ),
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-yellow-400 mb-2' }, stats.unreadMessages),
                        e('div', { className: 'text-slate-400' }, 'Unread Messages')
                    ),
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-purple-400 mb-2' }, stats.totalMessages),
                        e('div', { className: 'text-slate-400' }, 'Total Messages')
                    )
                ),

                e('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('h3', { className: 'text-xl font-semibold mb-4' }, 'Recent Projects'),
                        projects.slice(0, 5).map(project =>
                            e('div', { key: project.id, className: 'flex items-center justify-between py-3 border-b border-slate-700 last:border-0' },
                                e('div', null,
                                    e('div', { className: 'font-medium' }, project.title),
                                    e('div', { className: 'text-sm text-slate-500' }, project.status)
                                ),
                                e('span', { className: `px-2 py-1 rounded text-xs ${
                                    project.status === 'Deployed' ? 'bg-green-500/20 text-green-400' :
                                    project.status === 'Active' ? 'bg-blue-500/20 text-blue-400' :
                                    'bg-yellow-500/20 text-yellow-400'
                                }` }, project.status)
                            )
                        )
                    ),

                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('h3', { className: 'text-xl font-semibold mb-4' }, 'Recent Messages'),
                        messages.slice(0, 5).map(message =>
                            e('div', { key: message.id, className: 'py-3 border-b border-slate-700 last:border-0' },
                                e('div', { className: 'flex items-center justify-between mb-1' },
                                    e('div', { className: 'font-medium' }, message.name),
                                    e('div', { className: 'text-xs text-slate-500' },
                                        new Date(message.created_at).toLocaleDateString()
                                    )
                                ),
                                e('div', { className: 'text-sm text-slate-400 truncate' }, message.message)
                            )
                        )
                    )
                )
            );
        }

        // Projects Manager Component
        function ProjectsManager({ projects, technologies, onRefresh }) {
            const [showForm, setShowForm] = useState(false);
            const [editingProject, setEditingProject] = useState(null);

            return e('div', null,
                e('div', { className: 'flex justify-between items-center mb-8' },
                    e('h2', { className: 'text-3xl font-bold' }, 'Projects'),
                    e('button', {
                        onClick: () => {
                            setEditingProject(null);
                            setShowForm(true);
                        },
                        className: 'bg-emerald-500 hover:bg-emerald-600 px-6 py-3 rounded-lg font-semibold transition-colors'
                    }, '+ New Project')
                ),

                showForm ?
                    e(ProjectForm, {
                        project: editingProject,
                        technologies,
                        onClose: () => {
                            setShowForm(false);
                            setEditingProject(null);
                            onRefresh();
                        }
                    }) :
                    e('div', { className: 'grid grid-cols-1 gap-4' },
                        projects.map(project =>
                            e('div', {
                                key: project.id,
                                className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700'
                            },
                                e('div', { className: 'flex justify-between items-start' },
                                    e('div', { className: 'flex-1' },
                                        e('h3', { className: 'text-xl font-semibold mb-2' }, project.title),
                                        e('p', { className: 'text-slate-400 mb-3' }, project.description),
                                        e('div', { className: 'flex gap-2 flex-wrap' },
                                            e('span', { className: `px-3 py-1 rounded-full text-xs font-medium ${
                                                project.status === 'Deployed' ? 'bg-green-500/20 text-green-400' :
                                                project.status === 'Active' ? 'bg-blue-500/20 text-blue-400' :
                                                'bg-yellow-500/20 text-yellow-400'
                                            }` }, project.status),
                                            project.featured && e('span', {
                                                className: 'px-3 py-1 rounded-full text-xs font-medium bg-purple-500/20 text-purple-400'
                                            }, '⭐ Featured'),
                                            project.technologies && e('span', {
                                                className: 'text-xs text-slate-500'
                                            }, project.technologies)
                                        )
                                    ),
                                    e('div', { className: 'flex gap-2' },
                                        e('button', {
                                            onClick: () => {
                                                setEditingProject(project);
                                                setShowForm(true);
                                            },
                                            className: 'text-blue-400 hover:text-blue-300'
                                        }, '✏️'),
                                        e('button', {
                                            onClick: async () => {
                                                if (confirm('Delete this project?')) {
                                                    await fetch(`/api/projects/${project.id}`, { method: 'DELETE' });
                                                    onRefresh();
                                                }
                                            },
                                            className: 'text-red-400 hover:text-red-300'
                                        }, '🗑️')
                                    )
                                )
                            )
                        )
                    )
            );
        }

        // Project Form Component with Rich Text Editors
        function ProjectForm({ project, technologies, onClose }) {
            const [loading, setLoading] = useState(false);
            const [images, setImages] = useState([]);
            const [coverImageIndex, setCoverImageIndex] = useState(0);
            const [selectedTechs, setSelectedTechs] = useState(
                project?.technologies ? project.technologies.split(',').map(t => t.trim()) : []
            );

            const [formData, setFormData] = useState({
                title: project?.title || '',
                slug: project?.slug || '',
                description: project?.description || '',
                shortDescription: project?.short_description || '',
                status: project?.status || 'In Dev',
                category: project?.category || '',
                client: project?.client || '',
                duration: project?.duration || '',
                role: project?.role || '',
                teamSize: project?.team_size || '',
                liveUrl: project?.live_url || '',
                repoUrl: project?.repo_url || '',
                demoUrl: project?.demo_url || '',
                featured: project?.featured || false,

                // Rich text sections
                overview: project?.overview || '',
                challenge: project?.challenge || '',
                solution: project?.solution || '',
                process: project?.process || '',
                results: project?.results || '',
                technicalDetails: project?.technical_details || '',
                lessonsLearned: project?.lessons_learned || '',

                metaTitle: project?.meta_title || '',
                metaDescription: project?.meta_description || ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);

                const formDataToSend = new FormData();
                formDataToSend.append('data', JSON.stringify({
                    ...formData,
                    technologies: selectedTechs,
                    coverImageIndex
                }));

                // Add images
                images.forEach(image => {
                    formDataToSend.append('images', image);
                });

                try {
                    const url = project ? `/api/projects/${project.id}` : '/api/projects';
                    const method = project ? 'PUT' : 'POST';

                    const response = await fetch(url, {
                        method,
                        body: formDataToSend
                    });

                    if (response.ok) {
                        onClose();
                    } else {
                        alert('Failed to save project');
                    }
                } catch (error) {
                    console.error('Error saving project:', error);
                    alert('Failed to save project');
                } finally {
                    setLoading(false);
                }
            };

            const handleImageChange = (e) => {
                const files = Array.from(e.target.files);
                setImages(prev => [...prev, ...files]);
            };

            const removeImage = (index) => {
                setImages(prev => prev.filter((_, i) => i !== index));
                if (coverImageIndex === index) {
                    setCoverImageIndex(0);
                } else if (coverImageIndex > index) {
                    setCoverImageIndex(prev => prev - 1);
                }
            };

            const updateField = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));

                // Auto-generate slug from title
                if (field === 'title' && !project) {
                    const slug = value.toLowerCase()
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-|-$/g, '');
                    setFormData(prev => ({ ...prev, slug }));
                }
            };

            return e('div', { className: 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-auto' },
                e('div', { className: 'bg-slate-800 rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-auto' },
                    e('form', { onSubmit: handleSubmit },
                        e('div', { className: 'p-6 border-b border-slate-700' },
                            e('h3', { className: 'text-2xl font-bold' },
                                project ? 'Edit Project' : 'New Project'
                            )
                        ),

                        e('div', { className: 'p-6 space-y-6' },
                            // Basic Information
                            e('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Title *'),
                                    e('input', {
                                        type: 'text',
                                        value: formData.title,
                                        onChange: (e) => updateField('title', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none',
                                        required: true
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Slug *'),
                                    e('input', {
                                        type: 'text',
                                        value: formData.slug,
                                        onChange: (e) => updateField('slug', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none',
                                        required: true
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Status'),
                                    e('select', {
                                        value: formData.status,
                                        onChange: (e) => updateField('status', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none'
                                    },
                                        e('option', { value: 'In Dev' }, 'In Development'),
                                        e('option', { value: 'Active' }, 'Active'),
                                        e('option', { value: 'Deployed' }, 'Deployed'),
                                        e('option', { value: 'Archive' }, 'Archived')
                                    )
                                ),
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Category'),
                                    e('input', {
                                        type: 'text',
                                        value: formData.category,
                                        onChange: (e) => updateField('category', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none',
                                        placeholder: 'e.g., Web App, Mobile, Automation'
                                    })
                                )
                            ),

                            // Short Description
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium mb-2' }, 'Short Description'),
                                e('textarea', {
                                    value: formData.shortDescription,
                                    onChange: (e) => updateField('shortDescription', e.target.value),
                                    className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none',
                                    rows: 3,
                                    placeholder: 'Brief description for project cards'
                                })
                            ),

                            // Full Description
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium mb-2' }, 'Full Description'),
                                e('textarea', {
                                    value: formData.description,
                                    onChange: (e) => updateField('description', e.target.value),
                                    className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none',
                                    rows: 4
                                })
                            ),

                            // Project Details
                            e('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Client'),
                                    e('input', {
                                        type: 'text',
                                        value: formData.client,
                                        onChange: (e) => updateField('client', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none'
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Duration'),
                                    e('input', {
                                        type: 'text',
                                        value: formData.duration,
                                        onChange: (e) => updateField('duration', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none',
                                        placeholder: 'e.g., 3 months'
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Team Size'),
                                    e('input', {
                                        type: 'number',
                                        value: formData.teamSize,
                                        onChange: (e) => updateField('teamSize', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none'
                                    })
                                )
                            ),

                            // URLs
                            e('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Live URL'),
                                    e('input', {
                                        type: 'url',
                                        value: formData.liveUrl,
                                        onChange: (e) => updateField('liveUrl', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none'
                                    })
                                ),
                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Repository URL'),
                                    e('input', {
                                        type: 'url',
                                        value: formData.repoUrl,
                                        onChange: (e) => updateField('repoUrl', e.target.value),
                                        className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none'
                                    })
                                )
                            ),

                            // Technologies
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium mb-2' }, 'Technologies'),
                                e('div', { className: 'flex flex-wrap gap-2 mb-2' },
                                    technologies.map(tech =>
                                        e('button', {
                                            key: tech.id,
                                            type: 'button',
                                            onClick: () => {
                                                if (selectedTechs.includes(tech.name)) {
                                                    setSelectedTechs(prev => prev.filter(t => t !== tech.name));
                                                } else {
                                                    setSelectedTechs(prev => [...prev, tech.name]);
                                                }
                                            },
                                            className: `px-3 py-1 rounded-full text-sm transition-colors ${
                                                selectedTechs.includes(tech.name)
                                                    ? 'bg-emerald-500 text-white'
                                                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                            }`
                                        }, tech.name)
                                    )
                                )
                            ),

                            // Images
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium mb-2' }, 'Project Images'),
                                e('input', {
                                    type: 'file',
                                    multiple: true,
                                    accept: 'image/*',
                                    onChange: handleImageChange,
                                    className: 'w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-emerald-500 focus:outline-none'
                                }),
                                images.length > 0 && e('div', { className: 'image-preview-grid' },
                                    images.map((image, index) =>
                                        e('div', {
                                            key: index,
                                            className: `image-preview-item ${coverImageIndex === index ? 'selected' : ''}`,
                                            onClick: () => setCoverImageIndex(index)
                                        },
                                            e('img', {
                                                src: URL.createObjectURL(image),
                                                alt: `Preview ${index + 1}`
                                            }),
                                            coverImageIndex === index && e('div', { className: 'image-preview-badge' }, 'COVER'),
                                            e('div', {
                                                className: 'remove-image-btn',
                                                onClick: (e) => {
                                                    e.stopPropagation();
                                                    removeImage(index);
                                                }
                                            }, '×')
                                        )
                                    )
                                )
                            ),

                            // Rich Text Sections
                            e('div', { className: 'space-y-6' },
                                e('h4', { className: 'text-lg font-semibold text-emerald-400' }, 'Project Details'),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Overview'),
                                    e(RichTextEditor, {
                                        value: formData.overview,
                                        onChange: (value) => updateField('overview', value),
                                        placeholder: 'Project overview and objectives...'
                                    })
                                ),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'The Challenge'),
                                    e(RichTextEditor, {
                                        value: formData.challenge,
                                        onChange: (value) => updateField('challenge', value),
                                        placeholder: 'What problems did this project solve?'
                                    })
                                ),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'The Solution'),
                                    e(RichTextEditor, {
                                        value: formData.solution,
                                        onChange: (value) => updateField('solution', value),
                                        placeholder: 'How did you solve the challenges?'
                                    })
                                ),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Development Process'),
                                    e(RichTextEditor, {
                                        value: formData.process,
                                        onChange: (value) => updateField('process', value),
                                        placeholder: 'Describe the development process...'
                                    })
                                ),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Results & Impact'),
                                    e(RichTextEditor, {
                                        value: formData.results,
                                        onChange: (value) => updateField('results', value),
                                        placeholder: 'What were the outcomes and metrics?'
                                    })
                                ),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Technical Details'),
                                    e(RichTextEditor, {
                                        value: formData.technicalDetails,
                                        onChange: (value) => updateField('technicalDetails', value),
                                        placeholder: 'Technical implementation details...'
                                    })
                                ),

                                e('div', null,
                                    e('label', { className: 'block text-sm font-medium mb-2' }, 'Lessons Learned'),
                                    e(RichTextEditor, {
                                        value: formData.lessonsLearned,
                                        onChange: (value) => updateField('lessonsLearned', value),
                                        placeholder: 'Key takeaways and learnings...'
                                    })
                                )
                            ),

                            // Featured checkbox
                            e('div', { className: 'flex items-center gap-2' },
                                e('input', {
                                    type: 'checkbox',
                                    id: 'featured',
                                    checked: formData.featured,
                                    onChange: (e) => updateField('featured', e.target.checked),
                                    className: 'w-5 h-5 rounded border-slate-600 bg-slate-900 text-emerald-500 focus:ring-emerald-500'
                                }),
                                e('label', { htmlFor: 'featured', className: 'font-medium' }, 'Feature this project')
                            )
                        ),

                        e('div', { className: 'p-6 border-t border-slate-700 flex justify-end gap-4' },
                            e('button', {
                                type: 'button',
                                onClick: onClose,
                                className: 'px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors'
                            }, 'Cancel'),
                            e('button', {
                                type: 'submit',
                                disabled: loading,
                                className: 'px-6 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg font-semibold transition-colors disabled:opacity-50'
                            }, loading ? 'Saving...' : 'Save Project')
                        )
                    )
                )
            );
        }

        // Messages Manager
        function MessagesManager({ messages, onRefresh }) {
            return e('div', null,
                e('h2', { className: 'text-3xl font-bold mb-8' }, 'Messages'),

                e('div', { className: 'space-y-4' },
                    messages.map(message =>
                        e('div', {
                            key: message.id,
                            className: `bg-slate-800/50 rounded-xl p-6 border ${
                                message.is_read ? 'border-slate-700' : 'border-emerald-500/50'
                            }`
                        },
                            e('div', { className: 'flex justify-between items-start mb-4' },
                                e('div', null,
                                    e('h3', { className: 'font-semibold text-lg' }, message.name),
                                    e('p', { className: 'text-slate-400 text-sm' }, message.email),
                                    message.subject && e('p', { className: 'text-slate-300 mt-1' }, message.subject)
                                ),
                                e('div', { className: 'flex items-center gap-2' },
                                    !message.is_read && e('span', {
                                        className: 'px-2 py-1 bg-emerald-500/20 text-emerald-400 text-xs rounded-full'
                                    }, 'NEW'),
                                    e('span', { className: 'text-slate-500 text-sm' },
                                        new Date(message.created_at).toLocaleDateString()
                                    )
                                )
                            ),
                            e('p', { className: 'text-slate-300 mb-4' }, message.message),
                            e('div', { className: 'flex gap-2' },
                                !message.is_read && e('button', {
                                    onClick: async () => {
                                        await fetch(`/api/messages/${message.id}/read`, { method: 'PUT' });
                                        onRefresh();
                                    },
                                    className: 'text-blue-400 hover:text-blue-300'
                                }, '✓ Mark as Read'),
                                e('a', {
                                    href: `mailto:${message.email}?subject=Re: ${message.subject || 'Your message'}`,
                                    className: 'text-emerald-400 hover:text-emerald-300'
                                }, '↩️ Reply'),
                                e('button', {
                                    onClick: async () => {
                                        if (confirm('Delete this message?')) {
                                            await fetch(`/api/messages/${message.id}`, { method: 'DELETE' });
                                            onRefresh();
                                        }
                                    },
                                    className: 'text-red-400 hover:text-red-300 ml-auto'
                                }, '🗑️ Delete')
                            )
                        )
                    )
                )
            );
        }

        // Analytics Component
        function Analytics({ projects, messages }) {
            const [analytics, setAnalytics] = useState(null);
            const [timeframe, setTimeframe] = useState('7d');

            useEffect(() => {
                fetch(`/api/analytics?timeframe=${timeframe}`)
                    .then(res => res.json())
                    .then(data => setAnalytics(data))
                    .catch(console.error);
            }, [timeframe]);

            return e('div', null,
                e('div', { className: 'flex justify-between items-center mb-8' },
                    e('h2', { className: 'text-3xl font-bold' }, 'Analytics'),
                    e('select', {
                        value: timeframe,
                        onChange: (e) => setTimeframe(e.target.value),
                        className: 'bg-slate-800 border border-slate-600 rounded-lg px-4 py-2'
                    },
                        e('option', { value: '1d' }, 'Last 24 hours'),
                        e('option', { value: '7d' }, 'Last 7 days'),
                        e('option', { value: '30d' }, 'Last 30 days')
                    )
                ),

                analytics && e('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-blue-400 mb-2' },
                            analytics.summary?.pageViews || 0
                        ),
                        e('div', { className: 'text-slate-400' }, 'Page Views')
                    ),
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-emerald-400 mb-2' },
                            analytics.summary?.uniqueSessions || 0
                        ),
                        e('div', { className: 'text-slate-400' }, 'Unique Visitors')
                    ),
                    e('div', { className: 'bg-slate-800/50 rounded-xl p-6 border border-slate-700' },
                        e('div', { className: 'text-3xl font-bold text-purple-400 mb-2' },
                            analytics.summary?.projectViews || 0
                        ),
                        e('div', { className: 'text-slate-400' }, 'Project Views')
                    )
                )
            );
        }

        // Render the app
        ReactDOM.render(e(AdminApp), document.getElementById('root'));
    </script>
</body>
</html>